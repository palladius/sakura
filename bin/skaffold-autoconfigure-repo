#!/bin/bash

# TODO getops for project and region :)

# Possible errors (I got it at home):
#
# - I1124 20:58:14.730645   24170 versioner.go:58] no Auth Provider found for name "gcp"
# - W1124 20:58:14.797029   24170 gcp.go:120] WARNING: the gcp auth plugin is deprecated in v1.22+, unavailable in v1.25+; use gcloud instead.
# - To learn more, consult https://cloud.google.com/blog/products/containers-kubernetes/kubectl-auth-changes-in-gke
# - service "skaf-pasta-ror7" deleted
# According to https://cloud.google.com/blog/products/containers-kubernetes/kubectl-auth-changes-in-gke
# Doing this should suffice (but it doesnt on my computer):
#
#    gcloud container clusters get-credentials CLUSTER_NAME
#
PROJECT=$(gcloud config get project)
echo "This command will help you set up skaffold repo for your unique and very peculiar KðŸŽ±ðŸ¦¸ config: $(kubectl config current-context)"
echo Try one of these:
gcloud artifacts repositories list 2>/dev/null | grep DOCKER | while read AR_NAME dockerblah standard_blah LOCATION blah ; do
    REPONAME="$LOCATION-docker.pkg.dev/$PROJECT/$AR_NAME"
    echo "ðŸŒ» skaffold config set default-repo $REPONAME"
done
# TODO check with wc -l :)
echo 'If no flower came out, it means you need to first create an Artifact repository of type Docker (TODO autodetect).'
