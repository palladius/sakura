#!/usr/bin/env ruby

# This script requires GoogleCloud translate
# and an API key. I might find that I can achieve the same result with fewer requirements.


def check_prerequisites()
    begin
        require 'google/cloud/translate/v2'
    rescue Exception
        puts 'You need to do install this gem: gem install google-cloud-translate'
        exit 1
    end

    $key = GOOGLE_TRANSLATE_KEY.fetch('GOOGLE_TRANSLATE_KEY', nil)
    if $key.nil?
        puts 'Please export your GOOGLE_TRANSLATE_KEY peroperly. To get one, see TODO(docs)'
        exit 2
    end

end

#############################################
# This code uses the GCP translate API v2
# I believe no gcloud/bill is needed thouigh, just the aPI key.
# I might be wrong. I'm on a train and very cloudicant internet.
#############################################
def gtranslate(sentence, opts={})
    require 'google/cloud/translate/v2'

    destination_lang = opts.fetch :lang, 'en'
    begin
        translate_request = Google::Cloud::Translate::V2.new(key: $key)
        translation_response = translate_request.translate(sentence, to: destination_lang)
    rescue StandardError
    # flash.alert =
        puts("Google Translate error: #{$!}")
        return 'Some error happened'
    end

    return "TODO(): #{sentence}, but in #{destination_lang}"
end

def main()
    check_prerequisites
    sentence_to_translate = ARGV.join(' ')
    puts gtranslate(sentence_to_translate, lang: 'de')
end

main()
